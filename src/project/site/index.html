<html >
    <head>
        <meta charset="UTF-8"> 
        <title>XML/NodeJS framework - Index</title>
		<script src="https://d3js.org/d3.v5.min.js"></script>
		<!--<script src="d3/d3.min.js"></script>-->
        <script src="http://localhost:8080/socket.io/socket.io.js"></script>
        <script>
        	
        	function ul(index) {
	
        		var underlines = document.querySelectorAll(".underline");
        		var anode = document.querySelectorAll("a");
        		var size = anode[index].offsetWidth;
        		
        		var total=15;
        		for (var i = 0; i < index; i++){
        			total+=anode[i].offsetWidth + parseInt(getComputedStyle(anode[i]).marginLeft)+4;
        		}

        		for (var i = 0; i < underlines.length; i++) {
        			underlines[i].style.width = size+1;
        			underlines[i].style.transform = 'translate3d(' + total + 'px,0,0)';
        		}
        		
        		insertMenu(cast, index);
        	}
        </script>
        <link type="text/css" href="css/style.css" rel="stylesheet"/>
    </head>
    <body>
        <header>
            <menu>
                <div id="menu"></div>
            </menu>
        </header>
        <section id="content">
        	<div class="list_content">
        		<div class="title"></div>				
				<nav class="navLol">
					<div class="borderNav"></div>
					<div class="underline"></div>
					<div class="underline"></div>
					<div class="underline"></div>
					<a class="menuLOL" onclick="ul(0)">Tout</a>
					<a class="menuLOL" onclick="ul(1)">Assassins</a>
					<a class="menuLOL" onclick="ul(2)">Combattants</a>
					<a class="menuLOL" onclick="ul(3)">Mages</a>
					<a class="menuLOL" onclick="ul(4)">Tireurs</a>
					<a class="menuLOL" onclick="ul(5)">Supports</a>
					<a class="menuLOL" onclick="ul(6)">Tanks</a>
					<input class="inputsrch" type="text" placeholder="Rechercher">
					<img class="imgsrch" src="img/search.png"/>
				</nav>
        		<div class="list_champ"></div>
        	</div>
		</section>
		<footer>
			<div id="details" style="width:100%;height:717px; background-repeat: no-repeat; background-size: cover; background-image: url('http://localhost:8080/img/banner.png'); color:#f0e68c;">
				<div id="details-side" style="background-color: rgba(6, 28, 37, 0.6); height:800px; width:25%; display:inline-block;">
					<div>
						<h3 id="details-name"></h3> <h4 id="details-title" style="text-align: right;"></h4>
					</div>
					<br/>
					<div>
						<p id="details-desc" style="text-align: justify; font-size: small;"></p>
					</div>
					<hr/>
					<div>
						<h3>COMPÉTENCES</h3>
						<ul style="list-style: none;">
							<li id="details-spell-0"><img style="display: inline-block; width:64px; height: 64px;"></img><span></span></li>
							<li id="details-spell-1"><img style="display: inline-block; width:64px; height: 64px;"></img><span></span></li>
							<li id="details-spell-2"><img style="display: inline-block; width:64px; height: 64px;"></img><span></span></li>
							<li id="details-spell-3"><img style="display: inline-block; width:64px; height: 64px;"></img><span></span></li>
						</ul>
					</div>
					<hr/>
					Difficulté: <span id="details-diff"></span>
				</div>
				<div id="svgEmbed" style="width:500px; height:500px; margin:auto; display:inline-block;"><svg></svg></div>
			</div>
        </footer>

        <script>
        
        function insertMenu(root, filter) {
        		document.getElementsByClassName("list_champ")[0].innerHTML='';
        		postList = ["All","Assassin","Fighter","Mage","Marksman","Support","Tank"];

                //"use strict";
                //var json = JSON.parse(root);
                //console.log("root", root);
                console.log("items", root.items);
                //console.log("champion name", root.items[0].name);
                for (let i = 0; i < root.items.length; i++){
                	if (filter > 0 && root.items[i].tags[0] != postList[filter]){
                		continue
                	}
					var node = document.createElement("div");
					node.onclick = ()=>{
						var s = io.connect('http://localhost:8080');
						s.emit('selected', {"name":root.items[i].name});
						function random_item(items)
						{
						
						return items[Math.floor(Math.random()*items.length)];
							
						}

						d3.select("#details")
							.style("background-image", "url('http://localhost:8080/img/champion_splash/"+root.items[i].id+"_"+random_item(root.items[i].skins).num+".jpg')")
						
						d3.select("#details-name")
							.text(root.items[i].name);
						
						d3.select("#details-title")
							.text(root.items[i].title);
						
						d3.select("#details-desc")
							.text(root.items[i].lore);
						
						d3.select("#details-diff")
							.text(root.items[i].info.difficulty);

						d3.select("#details-spell-0")
							.select("img")
							.attr("src", "http://localhost:8080/img/champion_spell/"+root.items[i].spells[0].image.full)
							.attr("alt", root.items[i].spells[0].description)

						d3.select("#details-spell-0")
							.select("span")
							.text(root.items[i].spells[0].name)

						d3.select("#details-spell-1")
							.select("img")
							.attr("src", "http://localhost:8080/img/champion_spell/"+root.items[i].spells[1].image.full)
							.attr("alt", root.items[i].spells[1].description)

						d3.select("#details-spell-1")
							.select("span")
							.text(root.items[i].spells[1].name)

						d3.select("#details-spell-2")
							.select("img")
							.attr("src", "http://localhost:8080/img/champion_spell/"+root.items[i].spells[2].image.full)
							.attr("alt", root.items[i].spells[2].description)

						d3.select("#details-spell-2")
							.select("span")
							.text(root.items[i].spells[2].name)

						d3.select("#details-spell-3")
							.select("img")
							.attr("src", "http://localhost:8080/img/champion_spell/"+root.items[i].spells[3].image.full)
							.attr("alt", root.items[i].spells[3].description)

						d3.select("#details-spell-3")
							.select("span")
							.text(root.items[i].spells[3].name)

						d3.xml("http://localhost:8080/img/champion_info/"+root.items[i].name+'.svg')
							.then((documentFragment) => {
								
								var svgNode = documentFragment
											.getElementsByTagName("svg")[0];
								d3.select("#svgEmbed").select("svg").remove()
								d3.select("#svgEmbed").node().appendChild(svgNode);

								var innerSVG = d3.select("#svgEmbed").select("svg");
								innerSVG.select("rect")
									.attr("width",0)
									.attr("height",0)
								
								innerSVG.selectAll("text")
									.filter(function(d, i) { return i <= 2 ; })
									.style("font-family","font lol")
									.style("fill","#F0E68C")

								// TODO inner poly only
								// fill = linear-gradient(15deg, #00bcd4, #2E8B57, #00bcd4)
									
							})
					}
                	
                	var textnode = document.createElement("p");
                	textnode.innerHTML = root.items[i].name;
                	
                	var effect = document.createElement("span");
                	effect.setAttribute("class", "effect_list");
                	
                	var imgnode = document.createElement("img");
                	imgnode.setAttribute("src", "img/champion_loading/"+root.items[i].id+"_0.jpg");
                	
                	textnode.setAttribute("class", "textChamp");
                	
                	imgnode.setAttribute("class", "imgChamp");
                	
                	node.appendChild(imgnode);
                	node.appendChild(effect);
                	node.appendChild(textnode);
                	node.setAttribute("id", root.items[i].id);
                	node.setAttribute("class", "nameChamp");
                	document.getElementsByClassName("list_champ")[0].appendChild(node);
                }
            }
        	//var io = require('socket.io').listen(app.listen(8080), {log: true});
        	//var io = require('socket.io').listen(8080);
        	var s = io.connect('http://localhost:8080');
        	s.emit('ready', function(data){
        			console.log("info", data);
        	});

        	var cast;
			s.on('data', (data) =>{
				console.log(data);
				cast=data;
				//insertMenu(data, 0);
				ul(0);
			});
			

			s.on("details", (data)=>{
				console.log("details",data.name)
				var e = document.getElementById("details");
				
			});

        </script>
    </body>
</html>

